const express = require("express");
const app = express();
const cors = require("cors");
const port = 3042;

app.use(cors());
app.use(express.json());

const balances = {
  "0x3399666c7c00a0e31010": 100, // Private key: 0x7b2230223a3131342c2231223a3133312c2232223a3130362c2233223a38312c2234223a3131322c2235223a3133302c2236223a3130362c2237223a3235332c2238223a3131362c2239223a3136392c223130223a38322c223131223a34312c223132223a3130382c223133223a3139362c223134223a39352c223135223a3232352c223136223a3230362c223137223a3137382c223138223a3132372c223139223a37332c223230223a332c223231223a3230342c223232223a3139382c223233223a3136382c223234223a3135382c223235223a31382c223236223a31302c223237223a32302c223238223a3138352c223239223a3135332c223330223a3139382c223331223a3137327d
  "0xba2abdb7d94b40dd7400": 50, // Private key: 0x7b2230223a34302c2231223a31322c2232223a3131372c2233223a3134332c2234223a35332c2235223a3134352c2236223a31312c2237223a36342c2238223a342c2239223a3132392c223130223a3137322c223131223a37342c223132223a3233302c223133223a3135392c223134223a33382c223135223a33362c223136223a3133312c223137223a3137362c223138223a3233342c223139223a3137302c223230223a3234332c223231223a3231352c223232223a3133302c223233223a3133342c223234223a3231312c223235223a3135342c223236223a3130382c223237223a3233342c223238223a3135322c223239223a3230362c223330223a3130392c223331223a33337d
  "0x3fa0cf7dd879aea93d58": 75, // Private key: 0x7b2230223a3137372c2231223a3134312c2232223a32362c2233223a3130322c2234223a3136362c2235223a3139372c2236223a34342c2237223a3139332c2238223a3130362c2239223a3135352c223130223a35302c223131223a3139372c223132223a3231352c223133223a392c223134223a3235342c223135223a32332c223136223a31352c223137223a3133392c223138223a3132322c223139223a3136352c223230223a34362c223231223a3131382c223232223a3131362c223233223a38342c223234223a37362c223235223a3139362c223236223a3230312c223237223a3235302c223238223a3131302c223239223a3138342c223330223a32352c223331223a3231367d
};

app.get("/balance/:address", (req, res) => {
  const { address } = req.params;
  const balance = balances[address] || 0;
  res.send({ balance });
});

app.post("/send", (req, res) => {
  const { sender, recipient, amount } = req.body;

  setInitialBalance(sender);
  setInitialBalance(recipient);

  if (balances[sender] < amount) {
    res.status(400).send({ message: "Not enough funds!" });
  } else {
    balances[sender] -= amount;
    balances[recipient] += amount;
    res.send({ balance: balances[sender] });
  }
});

app.listen(port, () => {
  console.log(`Listening on port ${port}!`);
});

function setInitialBalance(address) {
  if (!balances[address]) {
    balances[address] = 0;
  }
}
